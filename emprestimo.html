<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ’¸ EmprÃ©stimos - MJ Tecnologia</title>
  <style>
    :root {
      --bg: #0a0f1f;
      --card: #141c2f;
      --text: #e2e8f0;
      --accent: #007bff;
      --sidebar: #10172a;
      --input-bg: #1e263b;
      --whatsapp: #25d366;
      --solicitar: #ffcc00;
    }

    body.light {
      --bg: #f4f6fb;
      --card: #ffffff;
      --text: #111;
      --accent: #007bff;
      --sidebar: #f0f0f0;
      --input-bg: #f1f1f1;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      display: flex;
      transition: 0.4s ease;
    }

    .sidebar {
      width: 240px;
      background: var(--sidebar);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transition: 0.3s;
    }

    .sidebar h2 {
      text-align: center;
      padding: 20px 0;
      color: var(--accent);
      margin: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar a {
      color: var(--text);
      padding: 12px 20px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      border-radius: 8px;
      margin: 6px 10px;
      transition: 0.3s;
    }

    .sidebar a:hover,
    .sidebar a.ativo {
      background: var(--accent);
      color: #fff;
    }

    header {
      background: var(--card);
      color: var(--accent);
      padding: 15px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 999;
      transition: 0.3s;
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      color: var(--accent);
    }

    .theme-toggle {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    .menu-btn {
      display: none;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 18px;
      margin-right: 10px;
    }

    main {
      margin-left: 260px;
      margin-top: 90px;
      padding: 0 20px;
      max-width: 1100px;
      width: 100%;
      transition: 0.3s;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
      transition: 0.3s;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: var(--input-bg);
      color: var(--text);
      font-size: 15px;
    }

    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 6px;
      font-weight: bold;
      transition: 0.3s;
    }

    button:hover { opacity: 0.9; }

    .btn-whatsapp { background: var(--whatsapp); }
    .btn-solicitar { background: var(--solicitar); color: #000; }
    .btn-danger { background: #dc2626; }
    .btn-renovar { background: #22c55e; }

    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.abrir { transform: translateX(0); }
      header { left: 0; }
      .menu-btn { display: inline-block; }
      main { margin-left: 0; }
    }

    #dadosCliente {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    #fotoCliente {
      width: 90px;
      height: 90px;
      border-radius: 10px;
      object-fit: cover;
      border: 2px solid var(--accent);
    }

    #dadosCliente p { margin: 4px 0; }

    #listaEmprestimos {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
    }

    .emprestimo-card {
      background: var(--card);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      transition: 0.3s;
    }

    .emprestimo-card:hover { transform: translateY(-3px); }

    .emprestimo-card img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      border: 2px solid var(--accent);
    }

    .emprestimo-info {
      flex: 1;
    }

    .emprestimo-info p {
      margin: 3px 0;
      font-size: 14px;
    }

    #filtroNome { margin-bottom: 10px; }
  </style>
</head>

<body>
  <aside class="sidebar" id="sidebar">
    <h2>ğŸ“Š MJ</h2>
    <a href="index.html">ğŸ  Dashboard</a>
    <a href="cliente.html">ğŸ‘¥ Clientes</a>
    <a href="emprestimo.html" class="ativo">ğŸ’¸ EmprÃ©stimos</a>
    <a href="config.html">âš™ï¸ ConfiguraÃ§Ãµes</a>
  </aside>

  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
      <h1>ğŸ’¸ EmprÃ©stimos - MJ Tecnologia</h1>
    </div>
    <button class="theme-toggle" onclick="alternarTema()">ğŸŒ™ Tema</button>
  </header>

  <main>
    <div class="card">
      <h2>ğŸ“‹ Dados do Cliente</h2>
      <div id="dadosCliente">
        <img id="fotoCliente" src="" alt="Foto de perfil">
        <div>
          <p><strong>ğŸ‘¤ Nome:</strong> <span id="clienteNome">---</span></p>
          <p><strong>ğŸ“± WhatsApp:</strong> <span id="clienteWhats">---</span></p>
          <p><strong>ğŸ“ EndereÃ§o:</strong> <span id="clienteEndereco">---</span></p>
        </div>
      </div>
    </div>

    <div class="card">
  <h2>ğŸ“ Novo EmprÃ©stimo</h2>
  <input type="number" id="valor" placeholder="Valor do emprÃ©stimo (R$)">
  <input type="number" id="juros" placeholder="Juros diÃ¡rios (%)" step="0.01">
  <input type="number" id="parcelas" placeholder="Quantidade de parcelas">
  <input type="date" id="dataInicio" placeholder="Data de inÃ­cio">
  <input type="date" id="dataVencimento" placeholder="Data de vencimento">
  
  <p id="resultadoJuros" style="margin-top:8px; font-weight:bold; color:var(--accent);"></p>
  
  <button onclick="salvarEmprestimo()">ğŸ’¾ Salvar</button>
  <button class="btn-solicitar">ğŸ“© Solicitar</button>
</div>
    <div class="card">
      <h2>ğŸ“‚ EmprÃ©stimos Cadastrados</h2>
      <input type="text" id="filtroNome" placeholder="Filtrar por nome do cliente...">
      <div id="listaEmprestimos"></div>
    </div>
  </main>

 <script>
  window.onload = () => {
    if (localStorage.getItem("tema") === "light") document.body.classList.add("light");
    atualizarIconeTema();

    const clienteTemp = JSON.parse(localStorage.getItem("emprestimoTemp"));
    if (clienteTemp) {
      document.getElementById("clienteNome").textContent = clienteTemp.nome || "Sem nome";
      document.getElementById("clienteWhats").textContent = clienteTemp.whatsapp || "Sem WhatsApp";
      document.getElementById("clienteEndereco").textContent = clienteTemp.endereco || "Sem endereÃ§o";
      if (clienteTemp.fotoPerfil) document.getElementById("fotoCliente").src = clienteTemp.fotoPerfil;
    }

    document.getElementById("filtroNome").addEventListener("input", exibirEmprestimos);
    exibirEmprestimos();

    // Atualiza o cÃ¡lculo quando qualquer campo mudar
    ["valor", "juros", "dataInicio", "dataVencimento"].forEach(id => {
      document.getElementById(id).addEventListener("input", calcularTotalComJuros);
    });
  };

  function calcularTotalComJuros() {
    const valor = parseFloat(document.getElementById("valor").value);
    const juros = parseFloat(document.getElementById("juros").value);
    const dataInicio = document.getElementById("dataInicio").value;
    const dataVencimento = document.getElementById("dataVencimento").value;

    if (!valor || !juros || !dataInicio || !dataVencimento) {
      document.getElementById("resultadoJuros").textContent = "";
      return;
    }

    const inicio = new Date(dataInicio);
    const vencimento = new Date(dataVencimento);
    const diffDias = Math.max(0, Math.floor((vencimento - inicio) / (1000 * 60 * 60 * 24)));

    const valorFinal = valor + (valor * (juros / 100) * diffDias);

    document.getElementById("resultadoJuros").textContent =
      `ğŸ’° Valor total estimado com juros atÃ© o vencimento (${diffDias} dias): R$ ${valorFinal.toFixed(2)}`;
  }

  function salvarEmprestimo() {
    const valor = parseFloat(document.getElementById("valor").value);
    const juros = parseFloat(document.getElementById("juros").value);
    const parcelas = document.getElementById("parcelas").value.trim();
    const dataInicio = document.getElementById("dataInicio").value.trim();
    const dataVencimento = document.getElementById("dataVencimento").value.trim();
    const cliente = JSON.parse(localStorage.getItem("emprestimoTemp"));

    if (!valor || !juros || !parcelas || !dataInicio || !dataVencimento)
      return alert("âš ï¸ Preencha todos os campos!");

    const inicio = new Date(dataInicio);
    const vencimento = new Date(dataVencimento);
    const diffDias = Math.max(0, Math.floor((vencimento - inicio) / (1000 * 60 * 60 * 24)));
    const total = valor + (valor * (juros / 100) * diffDias);

    const emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || [];
    emprestimos.push({
      id: Date.now(),
      nome: cliente?.nome || "Desconhecido",
      whatsapp: cliente?.whatsapp || "",
      endereco: cliente?.endereco || "",
      fotoPerfil: cliente?.fotoPerfil || "",
      valor,
      juros,
      parcelas,
      dataInicio,
      dataVencimento,
      total: total.toFixed(2),
      dias: diffDias
    });

    localStorage.setItem("emprestimos", JSON.stringify(emprestimos));
    alert("âœ… EmprÃ©stimo salvo com sucesso!");
    exibirEmprestimos();
  }

  function exibirEmprestimos() {
    const lista = document.getElementById("listaEmprestimos");
    const emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || [];
    const filtro = document.getElementById("filtroNome").value.toLowerCase();
    lista.innerHTML = "";

    const filtrados = emprestimos.filter(e => e.nome.toLowerCase().includes(filtro));

    filtrados.forEach(e => {
      const div = document.createElement("div");
      div.className = "emprestimo-card";
      div.innerHTML = `
        <img src="${e.fotoPerfil || 'https://via.placeholder.com/60'}" alt="Foto">
        <div class="emprestimo-info">
          <p><strong>${e.nome}</strong></p>
          <p>ğŸ’° R$ ${e.valor} + ${e.juros}% a.d.</p>
          <p>ğŸ“… ${e.parcelas}x - ${e.dataInicio} â†’ ${e.dataVencimento}</p>
          <p><strong>Total: R$ ${e.total}</strong> (${e.dias} dias)</p>
        </div>
        <div>
          <button class="btn-renovar" onclick="renovarEmprestimo(${e.id})">ğŸ”„</button>
          <button class="btn-danger" onclick="excluirEmprestimo(${e.id})">ğŸ—‘ï¸</button>
        </div>
      `;
      lista.appendChild(div);
    });

    if (filtrados.length === 0)
      lista.innerHTML = `<p style="text-align:center;opacity:0.7;">Nenhum emprÃ©stimo encontrado</p>`;
  }

  function excluirEmprestimo(id) {
    const emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || [];
    const novos = emprestimos.filter(e => e.id !== id);
    localStorage.setItem("emprestimos", JSON.stringify(novos));
    exibirEmprestimos();
  }

  function renovarEmprestimo(id) {
    const emprestimos = JSON.parse(localStorage.getItem("emprestimos")) || [];
    const emp = emprestimos.find(e => e.id === id);
    if (emp) {
      emp.id = Date.now();
      emp.dataInicio = new Date().toISOString().split("T")[0];
      emprestimos.push(emp);
      localStorage.setItem("emprestimos", JSON.stringify(emprestimos));
      alert("â™»ï¸ EmprÃ©stimo renovado com nova data!");
      exibirEmprestimos();
    }
  }
</script>

</body>
</html>
