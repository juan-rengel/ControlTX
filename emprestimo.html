<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ’¸ EmprÃ©stimos - MJ Tecnologia</title>
<style>
/* === ESTILO ORIGINAL MANTIDO === */
:root {
  --bg: #0a0f1f;
  --card: #141c2f;
  --text: #e2e8f0;
  --accent: #007bff;
  --sidebar: #10172a;
  --input-bg: #1e263b;
  --whatsapp: #25d366;
  --solicitar: #ffcc00;
}
body.light {
  --bg: #f4f6fb;
  --card: #ffffff;
  --text: #111;
  --accent: #007bff;
  --sidebar: #f0f0f0;
  --input-bg: #f1f1f1;
}
body {
  font-family: "Poppins", sans-serif;
  background: var(--bg);
  color: var(--text);
  margin: 0;
  display: flex;
  transition: 0.4s ease;
  min-height: 100vh;
}
.sidebar {
  width: 240px;
  background: var(--sidebar);
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 8px rgba(0,0,0,0.3);
  z-index: 1000;
  transition: transform 0.3s ease;
}
.sidebar h2 {
  text-align: center;
  padding: 20px 0;
  color: var(--accent);
  margin: 0;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.sidebar a {
  color: var(--text);
  padding: 12px 20px;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  border-radius: 8px;
  margin: 6px 10px;
  transition: 0.3s;
}
.sidebar a:hover,
.sidebar a.ativo {
  background: var(--accent);
  color: #fff;
}
header {
  background: var(--card);
  color: var(--accent);
  padding: 15px 25px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  position: fixed;
  top: 0;
  left: 240px;
  right: 0;
  z-index: 999;
  transition: left 0.3s;
}
header h1 { margin: 0; font-size: 22px; }
.menu-btn {
  background: none;
  border: none;
  color: var(--accent);
  font-size: 24px;
  cursor: pointer;
}
.theme-toggle {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
main {
  margin-left: 260px;
  margin-top: 90px;
  padding: 0 20px 50px;
  max-width: 1100px;
  width: 100%;
  transition: 0.3s;
}
.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  margin-bottom: 20px;
}
input, select {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: var(--input-bg);
  color: var(--text);
  font-size: 15px;
}
button {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 6px;
  font-weight: bold;
  transition: 0.3s;
}
button:hover { opacity: 0.9; }
.btn-danger { background: #dc2626; }
.btn-renovar { background: #22c55e; }
.btn-editar { background: #0ea5e9; }
.btn-solicitar { background: var(--solicitar); color: #000; }
.cliente-selected {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}
.cliente-selected img {
  width: 100px;
  height: 100px;
  border-radius: 10px;
  object-fit: cover;
  border: 2px solid var(--accent);
  cursor: pointer;
  transition: 0.3s;
}
.cliente-selected img:hover { transform: scale(1.05); }
#listaEmprestimos {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 12px;
  margin-top: 12px;
}
.emprestimo-card {
  background: rgba(255,255,255,0.03);
  border-radius: 12px;
  padding: 12px;
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  transition: 0.25s;
}
.emprestimo-card:hover { transform: translateY(-4px); }
.emprestimo-card img {
  width: 64px;
  height: 64px;
  border-radius: 8px;
  object-fit: cover;
  border: 2px solid var(--accent);
}
.emprestimo-info p { margin: 4px 0; font-size: 14px; }
.filtro { margin: 12px 0; max-width: 420px; }
.toast {
  position: fixed;
  top: 18px;
  right: 18px;
  background: #22c55e;
  color: white;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 8px 18px rgba(0,0,0,0.3);
  opacity: 0;
  transform: translateY(-8px);
  transition: 0.28s;
  z-index: 4000;
  font-weight: 600;
}
.toast.show { opacity: 1; transform: translateY(0); }
#imgModal {
  display: none;
  position: fixed;
  z-index: 5000;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.8);
  justify-content: center;
  align-items: center;
}
#imgModal img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(255,255,255,0.3);
}
#imgModal span {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 40px;
  color: white;
  cursor: pointer;
}
@media (max-width:768px){
  .sidebar { transform: translateX(-100%); }
  .sidebar.abrir { transform: translateX(0); }
  header { left: 0; }
  main { margin-left: 0; }
}

/* === Estilo para os botÃµes dentro do card de emprÃ©stimo === */
.emprestimo-card {
  display: flex;
  flex-direction: column;
  gap: 10px;
  padding: 12px;
  background: var(--card-bg, #222);
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* ContÃªiner de botÃµes (mantÃ©m duas linhas) */
.emprestimo-card .acoes {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}

/* BotÃµes */
.emprestimo-card button {
  width: 100%;
  padding: 8px 0;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  color: #fff;
  cursor: pointer;
  transition: transform 0.15s ease, opacity 0.2s ease;
}

.emprestimo-card button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

/* Cores especÃ­ficas */
.btn-pagar {
  background-color: #2ecc71; /* Verde */
}

.btn-reajuste {
  background-color: #f1c40f; /* Amarelo */
  color: #222;
}

.btn-editar {
  background-color: #3498db; /* Azul */
}

.btn-danger,
.btn-excluir {
  background-color: #e74c3c; /* Vermelho */
}

/* Caso queira garantir alinhamento visual dentro do card */
.emprestimo-card img {
  border-radius: 8px;
  width: 64px;
  height: 64px;
  object-fit: cover;
}
</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
  <h2>ğŸ“Š MJ</h2>
  <a href="index.html">ğŸ  Dashboard</a>
  <a href="cliente.html">ğŸ‘¥ Clientes</a>
  <a href="emprestimo.html" class="ativo">ğŸ’¸ EmprÃ©stimos</a>
  <a href="calendario.html">ğŸ“… CalendÃ¡rio</a>
  <a href="config.html">âš™ï¸ ConfiguraÃ§Ãµes</a>
</aside>

<header>
  <div style="display:flex;align-items:center;gap:10px;">
    <button class="menu-btn" onclick="toggleMenu()">â˜°</button>
    <h1>ğŸ’¸ EmprÃ©stimos - MJ Tecnologia</h1>
  </div>
  <button class="theme-toggle" onclick="alternarTema()">ğŸŒ™ Tema</button>
</header>

<main>
  <div class="card" id="cardClienteSelecionado">
    <h2>ğŸ‘¤ Cliente Selecionado</h2>
    <div class="cliente-selected">
      <img id="fotoCliente" src="" alt="Foto do cliente" onclick="abrirImagem(this.src)">
      <div>
        <p><strong id="clienteNome">---</strong></p>
        <p>ğŸ“± <span id="clienteWhats">---</span></p>
        <p>ğŸ“ <span id="clienteEndereco">---</span></p>
      </div>
    </div>
  </div>

  <div class="card">
    <h2 id="formTitle">ğŸ“ Novo EmprÃ©stimo</h2>
    <label>Valor (R$)</label>
    <input type="number" id="valor" step="0.01" placeholder="Ex: 1500.00">
    <label>Juros diÃ¡rio (%)</label>
    <input type="number" id="juros" step="0.01" placeholder="Ex: 1.5">
    <label>Dias</label>
    <input type="number" id="dias" placeholder="Ex: 30">
    <p id="displayTotal" style="margin-top:8px;font-weight:700;color:var(--accent);"></p>
    <div style="margin-top:10px; display:flex; gap:8px;">
      <button id="btnSalvar" onclick="handleSalvar()">ğŸ’¾ Salvar</button>
      <button id="btnCancelar" onclick="cancelarEdicao()" style="display:none;">âœ– Cancelar</button>
      <button id="btnExcluir" onclick="excluirEmprestimo(editingId)" style="display:none;" class="btn-danger">ğŸ—‘ï¸ Excluir</button>
    </div>
  </div>

  <div class="card">
    <h2>ğŸ“‚ EmprÃ©stimos Cadastrados</h2>
    <div class="filtro">
      <input type="text" id="filtroNome" placeholder="Filtrar por nome do cliente..." />
    </div>
    <div id="listaEmprestimos"></div>
  </div>
</main>

<div id="toast" class="toast"></div>

<div id="imgModal">
  <span onclick="fecharImagem()">&times;</span>
  <img id="modalImg" src="">
</div>

<script>
/* === FUNÃ‡Ã•ES GERAIS MANTIDAS === */
function abrirImagem(src){ const modal=document.getElementById('imgModal'); const img=document.getElementById('modalImg'); img.src=src; modal.style.display='flex'; }
function fecharImagem(){ document.getElementById('imgModal').style.display='none'; }
function toggleMenu(){ document.getElementById('sidebar').classList.toggle('abrir'); }
function alternarTema(){ document.body.classList.toggle('light'); localStorage.setItem('tema',document.body.classList.contains('light')?'light':'dark'); atualizarIconeTema(); }
function atualizarIconeTema(){ const btn=document.querySelector('.theme-toggle'); btn.textContent=document.body.classList.contains('light')?'â˜€ï¸ Tema':'ğŸŒ™ Tema'; }

let editingId=null; let isRenewMode=false; const toastEl=document.getElementById('toast');

/* === AJUSTE: Permitir acesso direto ao emprÃ©stimo.html === */
window.addEventListener('DOMContentLoaded',()=>{
  const clienteTemp=JSON.parse(localStorage.getItem('emprestimoTemp'));
  const temCliente=(clienteTemp && clienteTemp.nome);

  if(!temCliente){
    document.getElementById('clienteNome').textContent='---';
    document.getElementById('clienteWhats').textContent='---';
    document.getElementById('clienteEndereco').textContent='---';
    document.getElementById('fotoCliente').src='https://via.placeholder.com/64';
    mostrarToast('âš ï¸ Nenhum cliente selecionado â€” modo visualizaÃ§Ã£o.');
  } else {
    document.getElementById('clienteNome').textContent=clienteTemp.nome;
    document.getElementById('clienteWhats').textContent=clienteTemp.whatsapp||'---';
    document.getElementById('clienteEndereco').textContent=clienteTemp.endereco||'---';
    if(clienteTemp.fotoPerfil) document.getElementById('fotoCliente').src=clienteTemp.fotoPerfil;
  }

  if(localStorage.getItem('tema')==='light') document.body.classList.add('light');
  atualizarIconeTema();

  ['valor','juros','dias'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.addEventListener('input',atualizarDisplayTotal);
  });
  document.getElementById('filtroNome').addEventListener('input',exibirEmprestimos);

  const configSistema=JSON.parse(localStorage.getItem('configSistema'))||{};
  const campoJuros=document.getElementById('juros');
  if(configSistema.tipoJuros&&configSistema.taxaJuros!==undefined){
    campoJuros.value=configSistema.taxaJuros;
    campoJuros.dataset.tipoJuros=configSistema.tipoJuros;
  }

  exibirEmprestimos();
});

/* === CÃ¡lculo de juros === */
function calcularTotal(valor,jurosPercent,dias){
  const v=Number(valor)||0; const j=Number(jurosPercent)||0; const d=Math.max(0,Number(dias)||0);
  const tipo=document.getElementById('juros').dataset.tipoJuros||'composto';
  if(tipo==='simples') return v*(1+(j/100)*d);
  return v*Math.pow(1+j/100,d);
}

function atualizarDisplayTotal(){
  const valor=parseFloat(document.getElementById('valor').value);
  const juros=parseFloat(document.getElementById('juros').value);
  const dias=parseInt(document.getElementById('dias').value);
  if(!valor||!juros||!dias){
    document.getElementById('displayTotal').textContent='';
    return;
  }
  const total=calcularTotal(valor,juros,dias);
  const tipo=document.getElementById('juros').dataset.tipoJuros||'composto';
  document.getElementById('displayTotal').textContent=`ğŸ’° Total estimado (${tipo}): R$ ${total.toFixed(2)} (${dias} dias)`;
}

/* === SALVAR === */
function handleSalvar(){
  const cliente=JSON.parse(localStorage.getItem('emprestimoTemp'));
  if(!cliente||!cliente.nome){
    alert('âš ï¸ Nenhum cliente selecionado para novo emprÃ©stimo.');
    return;
  }

  const valor=parseFloat(document.getElementById('valor').value);
  const juros=parseFloat(document.getElementById('juros').value);
  const dias=parseInt(document.getElementById('dias').value);
  if(!valor||isNaN(juros)||isNaN(dias)){
    alert('âš ï¸ Preencha corretamente os campos.');
    return;
  }

  const total=calcularTotal(valor,juros,dias);
  const emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[];

  if(editingId){
    const idx=emprestimos.findIndex(e=>e.id===editingId);
    if(idx>=0){
      emprestimos[idx]={...emprestimos[idx],valor:valor.toFixed(2),juros,dias,total:total.toFixed(2),updatedAt:new Date().toISOString()};
      mostrarToast('âœï¸ EmprÃ©stimo atualizado!');
    }
  } else {
    const novo={
      id:Date.now(),
      nome:cliente.nome,
      whatsapp:cliente.whatsapp||'',
      endereco:cliente.endereco||'',
      fotoPerfil:cliente.fotoPerfil||'',
      valor:valor.toFixed(2),
      juros,
      dias,
      total:total.toFixed(2),
      tipoJuros:document.getElementById('juros').dataset.tipoJuros||'composto',
      createdAt:new Date().toISOString(),
      pago:false
    };
    emprestimos.push(novo);
    mostrarToast('âœ… EmprÃ©stimo salvo!');
  }

  localStorage.setItem('emprestimos',JSON.stringify(emprestimos));
  cancelarEdicao();
  exibirEmprestimos();
}

/* === RESTANTE DO CÃ“DIGO ORIGINAL === */
function limparFormulario(){ ['valor','juros','dias'].forEach(id=>document.getElementById(id).value=''); document.getElementById('displayTotal').textContent=''; }
function cancelarEdicao(){ limparFormulario(); editingId=null; document.getElementById('btnCancelar').style.display='none'; document.getElementById('btnExcluir').style.display='none'; document.getElementById('formTitle').textContent='ğŸ“ Novo EmprÃ©stimo'; }

/* === LISTAGEM COM OPÃ‡Ã•ES DE PAGAMENTO E REAJUSTE === */
function exibirEmprestimos(){
  const listaEl=document.getElementById('listaEmprestimos');
  const emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[];
  const filtro=(document.getElementById('filtroNome').value||'').toLowerCase();
  listaEl.innerHTML='';
  const filtrados=emprestimos.filter(e=>e.nome.toLowerCase().includes(filtro));
  if(filtrados.length===0){
    listaEl.innerHTML='<p style="opacity:0.7;text-align:center;">Nenhum emprÃ©stimo encontrado</p>';
    return;
  }
  filtrados.forEach(e=>{
    const card=document.createElement('div');
    card.className='emprestimo-card';
    card.innerHTML=`
      <div style="display:flex;gap:12px;align-items:center;">
        <img src="${e.fotoPerfil||'https://via.placeholder.com/64'}" alt="foto" onclick="abrirImagem(this.src)">
        <div class="emprestimo-info">
          <p><strong>${e.nome}</strong></p>
          <p>ğŸ’µ Valor: R$ ${Number(e.valor).toFixed(2)}</p>
          <p>ğŸ“ˆ Juros: ${Number(e.juros)}% ao dia</p>
          <p>ğŸ“… Dias: ${e.dias}</p>
          <p>ğŸ’° Total: R$ ${Number(e.total).toFixed(2)}</p>
          <p>${e.pago ? 'âœ… Pago' : 'â³ Em aberto'}</p>
        </div>
      </div>
      <div class="acoes">
        <button class="btn-editar" onclick="editarEmprestimo(${e.id})">âœï¸</button>
        <button class="btn-danger" onclick="excluirEmprestimo(${e.id})">ğŸ—‘ï¸</button>
        <button class="btn-pagar" onclick="marcarPago(${e.id})">ğŸ’¸ Pagar</button>
        <button class="btn-reajuste" onclick="reajustarEmprestimo(${e.id})">ğŸ”„ Reajuste</button>
      </div>`;
    listaEl.appendChild(card);
  });
}

/* === FUNÃ‡Ã•ES DE PAGAMENTO E REAJUSTE === */
function marcarPago(id){
  const emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[];
  const idx=emprestimos.findIndex(e=>e.id===id);
  if(idx>=0){
    emprestimos[idx].pago=!emprestimos[idx].pago;
    localStorage.setItem('emprestimos',JSON.stringify(emprestimos));
    mostrarToast(emprestimos[idx].pago ? 'ğŸ’¸ EmprÃ©stimo marcado como pago!' : 'â³ EmprÃ©stimo reaberto!');
    exibirEmprestimos();
  }
}

function reajustarEmprestimo(id){
  const emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[];
  const e=emprestimos.find(x=>x.id===id);
  if(!e) return;
  const novoDias=prompt('Informe o novo nÃºmero de dias:', e.dias);
  if(novoDias===null) return;
  e.dias=parseInt(novoDias);
  e.total=calcularTotal(e.valor,e.juros,e.dias).toFixed(2);
  e.updatedAt=new Date().toISOString();
  localStorage.setItem('emprestimos',JSON.stringify(emprestimos));
  mostrarToast('ğŸ”„ EmprÃ©stimo reajustado!');
  exibirEmprestimos();
}

function editarEmprestimo(id){ const emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[]; const e=emprestimos.find(x=>x.id===id); if(!e) return; editingId=id; document.getElementById('valor').value=e.valor; document.getElementById('juros').value=e.juros; document.getElementById('dias').value=e.dias; document.getElementById('juros').dataset.tipoJuros=e.tipoJuros||'composto'; document.getElementById('btnCancelar').style.display='inline-block'; document.getElementById('btnExcluir').style.display='inline-block'; document.getElementById('formTitle').textContent='âœï¸ Editar EmprÃ©stimo'; atualizarDisplayTotal(); }
function excluirEmprestimo(id){ if(!confirm('Excluir este emprÃ©stimo?')) return; let emprestimos=JSON.parse(localStorage.getItem('emprestimos'))||[]; emprestimos=emprestimos.filter(e=>e.id!==id); localStorage.setItem('emprestimos',JSON.stringify(emprestimos)); exibirEmprestimos(); mostrarToast('ğŸ—‘ï¸ EmprÃ©stimo removido.'); }
function mostrarToast(msg){ toastEl.textContent=msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),2200); }
</script>





</body>
</html>
