<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üë• Clientes - MJ Tecnologia</title>
  <style>
    :root {
      --bg: #0a0f1f;
      --card: #141c2f;
      --text: #e2e8f0;
      --accent: #007bff;
      --sidebar: #10172a;
      --input-bg: #1e263b;
    }

    body.light {
      --bg: #f4f6fb;
      --card: #ffffff;
      --text: #111;
      --accent: #007bff;
      --sidebar: #f0f0f0;
      --input-bg: #f1f1f1;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      display: flex;
      transition: 0.4s ease;
    }

    .sidebar {
      width: 240px;
      background: var(--sidebar);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      transition: 0.3s;
    }

    .sidebar h2 {
      text-align: center;
      padding: 20px 0;
      color: var(--accent);
      margin: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar a {
      color: var(--text);
      padding: 12px 20px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
      border-radius: 8px;
      margin: 6px 10px;
      transition: 0.3s;
    }

    .sidebar a:hover,
    .sidebar a.ativo {
      background: var(--accent);
      color: #fff;
    }

    header {
      background: var(--card);
      color: var(--accent);
      padding: 15px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 999;
      transition: 0.3s;
    }

    header h1 {
      margin: 0;
      font-size: 22px;
      color: var(--accent);
    }

    .theme-toggle {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.3s;
    }

    .theme-toggle:hover {
      opacity: 0.9;
    }

    .menu-btn {
      display: none;
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 18px;
      margin-right: 10px;
    }

    main {
      margin-left: 260px;
      margin-top: 90px;
      padding: 0 20px;
      max-width: 1100px;
      width: 100%;
      transition: 0.3s;
    }

    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      margin-bottom: 20px;
      transition: 0.3s;
    }

    .card:hover {
      transform: scale(1.01);
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      background: var(--input-bg);
      color: var(--text);
      font-size: 15px;
    }

    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      margin-right: 6px;
      font-weight: bold;
      transition: 0.3s;
    }

    button:hover {
      opacity: 0.9;
    }

    .btn-danger {
      background: red;
    }

    .cliente-card {
      display: flex;
      align-items: flex-start;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 12px 16px;
      margin-bottom: 10px;
      gap: 15px;
      flex-wrap: wrap;
    }

    .cliente-imagens img {
      width: 90px;
      height: 90px;
      object-fit: cover;
      border-radius: 10px;
      cursor: pointer;
      margin-right: 6px;
      border: 2px solid var(--accent);
      transition: 0.3s;
    }

    .cliente-imagens img:hover {
      transform: scale(1.1);
    }

    .cliente-info {
      flex: 1;
    }

    .cliente-botoes {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      padding-top: 60px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.8);
    }

    .modal-content {
      margin: auto;
      display: block;
      max-width: 90%;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .modal-caption {
      text-align: center;
      color: #fff;
      margin-top: 10px;
      font-size: 18px;
    }

    .fechar {
      position: absolute;
      top: 25px;
      right: 45px;
      color: white;
      font-size: 40px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }

    .fechar:hover {
      color: var(--accent);
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }
      .sidebar.abrir {
        transform: translateX(0);
      }
      header {
        left: 0;
      }
      .menu-btn {
        display: inline-block;
      }
      main {
        margin-left: 0;
      }
    }
  </style>
</head>

<body>
  <aside class="sidebar" id="sidebar">
    <h2>üìä MJ</h2>
    <a href="index.html">üè† Dashboard</a>
    <a href="cliente.html" class="ativo">üë• Clientes</a>
    <a href="emprestimo.html">üí∏ Empr√©stimos</a>
    <a href="config.html">‚öôÔ∏è Configura√ß√µes</a>
  </aside>

  <header>
    <div style="display:flex;align-items:center;gap:10px;">
      <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
      <h1>üë• Clientes - MJ Tecnologia</h1>
    </div>
    <button class="theme-toggle" onclick="alternarTema()">üåô Tema</button>
  </header>

  <main>
    <div class="card">
      <h2>Novo Cliente</h2>
      <input type="text" id="nome" placeholder="Nome do cliente" />
      <input type="text" id="whatsapp" placeholder="WhatsApp" />
      <input type="text" id="endereco" placeholder="Endere√ßo (opcional)" />

      <label>üì∏ Foto de Perfil:</label>
      <input type="file" id="fotoPerfil" accept="image/*" />

      <label>üìÑ Foto Documento:</label>
      <input type="file" id="fotoDocumento" accept="image/*" />

      <label>üè† Comprovante de Resid√™ncia:</label>
      <input type="file" id="comprovanteResidencia" accept="image/*" />

      <button onclick="salvarCliente()">üíæ Salvar</button>
      <button class="btn-danger" onclick="limparCampos()">üßπ Limpar</button>
    </div>

    <div class="card">
      <h2>üìã Clientes Cadastrados</h2>
      <input type="text" id="filtroCliente" placeholder="üîç Filtrar por nome..." oninput="filtrarClientes()" />
      <div id="listaClientes"></div>
    </div>
  </main>

  <!-- Modal -->
  <div id="modalImagem" class="modal" onclick="fecharModal()">
    <span class="fechar">&times;</span>
    <img class="modal-content" id="imgModal" />
    <div class="modal-caption" id="caption"></div>
  </div>

  <script>
    function alternarTema() {
      document.body.classList.toggle("light");
      const tema = document.body.classList.contains("light") ? "light" : "dark";
      localStorage.setItem("tema", tema);
      atualizarIconeTema();
    }

    function atualizarIconeTema() {
      const btn = document.querySelector(".theme-toggle");
      btn.textContent = document.body.classList.contains("light") ? "‚òÄÔ∏è Tema" : "üåô Tema";
    }

    function toggleMenu() {
      const sidebar = document.getElementById("sidebar");
      sidebar.classList.toggle("abrir");
      const links = sidebar.querySelectorAll("a");
      links.forEach(link => link.addEventListener("click", () => {
        if (window.innerWidth <= 768) sidebar.classList.remove("abrir");
      }));
    }

    /* --- Fun√ß√£o corrigida --- */
    function salvarCliente() {
      const nome = document.getElementById("nome").value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
      const endereco = document.getElementById("endereco").value.trim();
      const fotoPerfilInput = document.getElementById("fotoPerfil");
      const fotoDocumentoInput = document.getElementById("fotoDocumento");
      const comprovanteResidenciaInput = document.getElementById("comprovanteResidencia");

      if (!nome) return alert("‚ö†Ô∏è Informe o nome do cliente!");

      const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
      if (clientes.some(c => c.nome.toLowerCase() === nome.toLowerCase()))
        return alert("‚ö†Ô∏è Este cliente j√° est√° cadastrado!");

      const cliente = { nome, whatsapp, endereco, fotoPerfil: "", fotoDocumento: "", comprovanteResidencia: "" };

      const salvarNoStorage = () => {
        clientes.push(cliente);
        localStorage.setItem("clientes", JSON.stringify(clientes));
        exibirClientes();
        limparCampos();
      };

      const carregarImagem = (input, callback) => {
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = e => callback(e.target.result);
          reader.readAsDataURL(input.files[0]);
        } else {
          callback("");
        }
      };

      carregarImagem(fotoPerfilInput, perfil => {
        cliente.fotoPerfil = perfil;
        carregarImagem(fotoDocumentoInput, doc => {
          cliente.fotoDocumento = doc;
          carregarImagem(comprovanteResidenciaInput, comp => {
            cliente.comprovanteResidencia = comp;
            salvarNoStorage();
          });
        });
      });
    }

    function limparCampos() {
      ["nome", "whatsapp", "endereco", "fotoPerfil", "fotoDocumento", "comprovanteResidencia"].forEach(id => {
        document.getElementById(id).value = "";
      });
    }

    function exibirClientes(listaFiltrada) {
      const lista = document.getElementById("listaClientes");
      lista.innerHTML = "";
      const clientes = listaFiltrada || JSON.parse(localStorage.getItem("clientes")) || [];

      clientes.forEach((c, i) => {
        const div = document.createElement("div");
        div.className = "cliente-card";
        div.innerHTML = `
          <div class="cliente-imagens">
            ${c.fotoPerfil ? `<img src="${c.fotoPerfil}" alt="Perfil" onclick="abrirModal('${c.fotoPerfil}','${c.nome}','Foto de Perfil')">` : ""}
            ${c.fotoDocumento ? `<img src="${c.fotoDocumento}" alt="Documento" onclick="abrirModal('${c.fotoDocumento}','${c.nome}','Documento')">` : ""}
            ${c.comprovanteResidencia ? `<img src="${c.comprovanteResidencia}" alt="Comprovante" onclick="abrirModal('${c.comprovanteResidencia}','${c.nome}','Comprovante de Resid√™ncia')">` : ""}
          </div>
          <div class="cliente-info">
            <strong>üë§ ${c.nome}</strong><br>
            üì± ${c.whatsapp || "Sem n√∫mero"}<br>
            üìç ${c.endereco || "Sem endere√ßo"}
            <div class="cliente-botoes">
              <button onclick="window.open('https://wa.me/55${c.whatsapp}','_blank')">üí¨ WhatsApp</button>
              <button onclick="solicitarEmprestimo('${c.nome}','${c.whatsapp}')">üí∏ Solicitar</button>
              <button onclick="editarCliente(${i})">‚úèÔ∏è Editar</button>
              <button class="btn-danger" onclick="excluirCliente(${i})">üóëÔ∏è Excluir</button>
            </div>
          </div>`;
        lista.appendChild(div);
      });
    }

    function abrirModal(src, nome, tipo) {
      const modal = document.getElementById("modalImagem");
      const imgModal = document.getElementById("imgModal");
      const caption = document.getElementById("caption");
      modal.style.display = "block";
      imgModal.src = src;
      caption.textContent = `${nome} - ${tipo}`;
    }

    function fecharModal() {
      document.getElementById("modalImagem").style.display = "none";
    }

    function solicitarEmprestimo(nome, whatsapp) {
      localStorage.setItem("emprestimoTemp", JSON.stringify({ nome, whatsapp }));
      window.location.href = "emprestimo.html";
    }

    function editarCliente(i) {
      const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
      const c = clientes[i];
      document.getElementById("nome").value = c.nome;
      document.getElementById("whatsapp").value = c.whatsapp;
      document.getElementById("endereco").value = c.endereco || "";
      clientes.splice(i, 1);
      localStorage.setItem("clientes", JSON.stringify(clientes));
      exibirClientes();
    }

    function excluirCliente(i) {
      const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
      if (confirm("Excluir este cliente?")) {
        clientes.splice(i, 1);
        localStorage.setItem("clientes", JSON.stringify(clientes));
        exibirClientes();
      }
    }

    function filtrarClientes() {
      const termo = document.getElementById("filtroCliente").value.toLowerCase();
      const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
      const filtrados = clientes.filter(c => c.nome.toLowerCase().includes(termo));
      exibirClientes(filtrados);
    }

    window.onload = () => {
      const tema = localStorage.getItem("tema");
      if (tema === "light") document.body.classList.add("light");
      atualizarIconeTema();
      exibirClientes();
    };
  </script>
</body>
</html>
