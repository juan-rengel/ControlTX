<!DOCTYPE html>

<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>ğŸ‘¥ Clientes - MJ Tecnologia</title>
<style>
  :root{
    --bg:#0a0f1f;
    --card:#141c2f;
    --text:#e2e8f0;
    --accent:#007bff;
    --sidebar:#10172a;
    --input-bg:#1e263b;
    --whatsapp:#25d366;
    --solicitar:#ffc107;
  }
  body.light{
    --bg:#f4f6fb;
    --card:#ffffff;
    --text:#111;
    --accent:#007bff;
    --sidebar:#f0f0f0;
    --input-bg:#f1f1f1;
  }
  body{
    font-family:"Poppins",sans-serif;
    background:var(--bg);
    color:var(--text);
    margin:0;
    display:flex;
    transition:0.4s ease;
  }
.sidebar {
  width: 240px;
  background: var(--sidebar);
  height: 100vh;
  position: fixed;
  top: 0;
  left: 0;
  display: flex;
  flex-direction: column;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  transition: 0.3s;
}

.sidebar h2 {
  text-align: center;
  padding: 20px 0;
  color: var(--accent);
  margin: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.sidebar a {
  color: var(--text);
  padding: 12px 20px;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  border-radius: 8px;
  margin: 6px 10px;
  transition: 0.3s;
}

.sidebar a:hover,
.sidebar a.ativo {
  background: var(--accent);
  color: #fff;
}

/* ===== HEADER ===== */
header {
  background: var(--card);
  color: var(--accent);
  padding: 15px 25px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  position: fixed;
  top: 0;
  left: 240px;
  right: 0;
  z-index: 999;
  transition: 0.3s;
}

header h1 {
  margin: 0;
  font-size: 22px;
  color: var(--accent);
}

.theme-toggle {
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 14px;
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}

.menu-btn {
  display: none;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 18px;
  margin-right: 10px;
}

/* ===== MAIN ===== */
main {
  margin-left: 260px;
  margin-top: 90px;
  padding: 0 20px;
  max-width: 1100px;
  width: 100%;
  transition: 0.3s;
}

/* ===== CARD ===== */
.card {
  background: var(--card);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  margin-bottom: 20px;
  transition: 0.3s;
}

/* ===== INPUTS & BUTTONS ===== */
input {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  background: var(--input-bg);
  color: var(--text);
  font-size: 15px;
}

button {
  background: var(--accent);
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 6px;
  font-weight: bold;
  transition: 0.3s;
}

button:hover {
  opacity: 0.9;
}

.btn-danger {
  background: red;
}

.btn-whatsapp {
  background: var(--whatsapp);
  color: #fff;
}

.btn-solicitar {
  background: var(--solicitar);
  color: #000;
}

/* ===== CLIENTE CARD ===== */
.cliente-card {
  display: flex;
  align-items: flex-start;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  padding: 12px 16px;
  margin-bottom: 10px;
  gap: 15px;
  flex-wrap: wrap;
}

.cliente-foto {
  width: 120px;
  height: 120px;
  border-radius: 8px;
  object-fit: cover;
  margin-right: 16px;
  background: #e6e6e6;
}

.cliente-info {
  flex: 1;
}

.cliente-info h3 {
  margin: 0 0 6px 0;
}

.cliente-docs img {
  width: 80px;
  height: 80px;
  border-radius: 6px;
  object-fit: cover;
  margin-right: 10px;
  border: 1px solid #ccc;
}

/* ===== FILTRO ===== */
.filtro {
  margin: 20px auto;
  max-width: 400px;
  text-align: center;
}

.filtro input {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

/* ===== RESPONSIVO ===== */
@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%);
  }

  .sidebar.abrir {
    transform: translateX(0);
  }

  header {
    left: 0;
  }

  .menu-btn {
    display: inline-block;
  }

  main {
    margin-left: 0;
  }

  .cliente-card {
    flex-direction: column;
    text-align: center;
  }

  .cliente-foto {
    margin: 0 auto 10px auto;
  }
}

/* ===== TOAST ===== */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #22c55e;
  color: white;
  padding: 10px 14px;
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3);
  z-index: 4000;
  opacity: 0;
  transform: translateY(-8px);
  transition: opacity 0.28s, transform 0.28s;
  font-weight: 600;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
}



/* Ajustes responsivos para o card de clientes */
@media (max-width: 768px) {
  .card-cliente {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .card-cliente input {
    width: 90% !important;
    margin-bottom: 8px;
  }
  .card-cliente button {
    display: block;
    margin: 10px auto 0 auto;
  }
}
</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
<h2>ğŸ“Š MJ</h2>
<a href="index.html">ğŸ  Dashboard</a>
<a class="ativo" href="cliente.html">ğŸ‘¥ Clientes</a>
<a href="emprestimo.html">ğŸ’¸ EmprÃ©stimos</a>
<a href="calendario.html">ğŸ“… CalendÃ¡rio</a>
    <a href="config.html">âš™ï¸ ConfiguraÃ§Ãµes</a>
</aside>
<header>
<div style="display:flex;align-items:center;gap:10px;">
<button class="menu-btn" onclick="toggleMenu()">â˜°</button>
<h1>ğŸ‘¥ Clientes - MJ </h1>
</div>
<button class="theme-toggle" onclick="alternarTema()">ğŸŒ™ Tema</button>
</header>
<main>
<div class="card">
<h2>Novo Cliente</h2>
<form id="formCliente">
<input id="nome" placeholder="Nome do cliente" required="" type="text"/>
<input id="whatsapp" placeholder="WhatsApp" type="text"/>
<input id="endereco" placeholder="EndereÃ§o (opcional)" type="text"/>
<label>ğŸ“¸ Foto de Perfil:</label>
<input accept="image/*" id="fotoPerfil" type="file"/>
<label>ğŸ“„ Documento:</label>
<input accept="image/*" id="fotoDocumento" type="file"/>
<label>ğŸ  Comprovante de ResidÃªncia:</label>
<input accept="image/*" id="comprovanteResidencia" type="file"/>
<div style="margin-top:10px;">
<button id="btnSalvar" type="submit">ğŸ’¾ Salvar</button>
<button class="btn-danger" onclick="limparCampos()" type="button">ğŸ§¹ Limpar</button>
</div>
</form>
</div>
<div class="card">
<h2>ğŸ“‹ Clientes Cadastrados</h2>
<div class="filtro">
<input id="filtroNome" placeholder="ğŸ” Filtrar por nome do cliente..." type="text"/>
</div>
<div id="listaClientes"></div>
</div>
</main>
<div aria-hidden="true" class="toast" id="toast">âœ… Cliente salvo com sucesso!</div>
<script>
/* final robust script */
let editingId = null;

function showToast(msg){
  const t = document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=> t.classList.remove("show"), 1600);
}

function alternarTema(){
  document.body.classList.toggle("light");
  const tema = document.body.classList.contains("light") ? "light" : "dark";
  localStorage.setItem("tema", tema);
}
function toggleMenu(){
  document.getElementById("sidebar").classList.toggle("abrir");
}
document.querySelectorAll(".sidebar a").forEach(link=>{
  link.addEventListener("click", ()=> {
    if(window.innerWidth <= 768) document.getElementById("sidebar").classList.remove("abrir");
  });
});

const form = document.getElementById("formCliente");
const filtroNome = document.getElementById("filtroNome");
const listaEl = document.getElementById("listaClientes");

/* read file helper -> returns dataURL or null */
function readFileAsDataURL(input){
  return new Promise(resolve => {
    if(!input || !input.files || !input.files[0]) return resolve(null);
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = () => resolve(null);
    reader.readAsDataURL(input.files[0]);
  });
}

/* submit handler */
form.addEventListener("submit", async (e) => {
  e.preventDefault();
  await salvarCliente();
});

/* save (create or update) */
async function salvarCliente(){
  const nome = document.getElementById("nome").value.trim();
  const whatsapp = document.getElementById("whatsapp").value.trim();
  const endereco = document.getElementById("endereco").value.trim();
  const fotoPerfilInput = document.getElementById("fotoPerfil");
  const fotoDocumentoInput = document.getElementById("fotoDocumento");
  const comprovanteResidenciaInput = document.getElementById("comprovanteResidencia");

  if(!nome){ alert("âš ï¸ Informe o nome do cliente!"); return; }

  const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
  const editIdNum = editingId !== null ? Number(editingId) : null;

  const nomeExiste = clientes.some(c => c.nome.toLowerCase() === nome.toLowerCase() && Number(c.id) !== editIdNum);
  if(nomeExiste){ alert("âš ï¸ Este cliente jÃ¡ estÃ¡ cadastrado!"); return; }

  const existing = editIdNum !== null ? clientes.find(c => Number(c.id) === editIdNum) : null;

  const [perfilData, docData, compData] = await Promise.all([
    readFileAsDataURL(fotoPerfilInput),
    readFileAsDataURL(fotoDocumentoInput),
    readFileAsDataURL(comprovanteResidenciaInput)
  ]);

  const clienteObj = {
    id: editIdNum !== null ? editIdNum : Date.now(),
    nome,
    whatsapp,
    endereco,
    fotoPerfil: perfilData !== null ? perfilData : (existing ? existing.fotoPerfil : ""),
    fotoDocumento: docData !== null ? docData : (existing ? existing.fotoDocumento : ""),
    comprovanteResidencia: compData !== null ? compData : (existing ? existing.comprovanteResidencia : "")
  };

  const idx = clientes.findIndex(c => Number(c.id) === Number(clienteObj.id));
  if(idx >= 0) clientes[idx] = clienteObj; else clientes.push(clienteObj);

  localStorage.setItem("clientes", JSON.stringify(clientes));
  editingId = null;
  limparCampos();
  exibirClientes();
  showToast("âœ… Cliente salvo com sucesso!");
}

/* clear form */
function limparCampos(){
  form.reset();
  ["fotoPerfil","fotoDocumento","comprovanteResidencia"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.value = "";
  });
  editingId = null;
}

/* render list */
function exibirClientes(){
  const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
  const termo = (filtroNome.value || "").toLowerCase();
  listaEl.innerHTML = "";

  clientes
    .filter(c => c.nome.toLowerCase().includes(termo))
    .forEach(c => {
      const div = document.createElement("div");
      div.className = "cliente-card";
      div.innerHTML = `
        <img src="${c.fotoPerfil || 'https://via.placeholder.com/120?text=Sem+Foto'}" alt="Perfil" class="cliente-foto">
        <div class="cliente-info">
          <h3>${c.nome}</h3>
          <p><strong>WhatsApp:</strong> ${c.whatsapp || "-"}</p>
          <p><strong>EndereÃ§o:</strong> ${c.endereco || "-"}</p>
          <div class="cliente-docs" style="margin-top:10px;">
            ${c.fotoDocumento ? `<img src="${c.fotoDocumento}" alt="Documento">` : ""}
            ${c.comprovanteResidencia ? `<img src="${c.comprovanteResidencia}" alt="Comprovante">` : ""}
          </div>
          <div class="cliente-botoes" style="margin-top:12px;">
            <button class="btn-whatsapp" title="Abrir WhatsApp">ğŸ’¬ WhatsApp</button>
            <button class="btn-solicitar" onclick="solicitarEmprestimo('${c.nome}','${c.whatsapp}','${c.endereco}','${c.fotoPerfil || ''}')">ğŸ’¸ Solicitar</button>
            <button class="btn-editar" title="Editar cliente">âœï¸ Editar</button>
            <button class="btn-danger" title="Excluir cliente">ğŸ—‘ï¸ Excluir</button>
          </div>
        </div>
      `;

      const [btnWhats, btnSolicitar, btnEditar, btnExcluir] = div.querySelectorAll("button");

      btnWhats.addEventListener("click", () => {
        if(!c.whatsapp) return alert("Este cliente nÃ£o tem nÃºmero de WhatsApp cadastrado.");
        window.open(`https://wa.me/55${c.whatsapp}`, "_blank");
      });

      btnSolicitar.addEventListener("click", () => {
        solicitarEmprestimo(c.nome, c.whatsapp);
      });

      btnEditar.addEventListener("click", () => {
        // fill textual fields (files cannot be programmatically set)
        document.getElementById("nome").value = c.nome;
        document.getElementById("whatsapp").value = c.whatsapp || "";
        document.getElementById("endereco").value = c.endereco || "";
        editingId = Number(c.id);
        showToast("âœï¸ Modo ediÃ§Ã£o â€” atualize campos e clique Salvar");
      });

      btnExcluir.addEventListener("click", () => {
        excluirCliente(Number(c.id));
      });

      listaEl.appendChild(div);
    });
}
function solicitarEmprestimo(nome, whatsapp, endereco, fotoPerfil) {
  localStorage.setItem("emprestimoTemp", JSON.stringify({
    nome, whatsapp, endereco, fotoPerfil
  }));
  window.location.href = "emprestimo.html";
}

function solicitarEmprestimo(nome, whatsapp) {
  const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
  const cliente = clientes.find(c => c.nome === nome);

  if (cliente) {
    // Salva todas as informaÃ§Ãµes no localStorage temporÃ¡rio
    localStorage.setItem("emprestimoTemp", JSON.stringify({
      nome: cliente.nome,
      whatsapp: cliente.whatsapp,
      endereco: cliente.endereco,
      fotoPerfil: cliente.fotoPerfil
    }));
  }

  window.location.href = "emprestimo.html";
}


function excluirCliente(id){
  const clientes = JSON.parse(localStorage.getItem("clientes")) || [];
  const idx = clientes.findIndex(c => Number(c.id) === Number(id));
  if(idx === -1) return;
  if(confirm("Excluir este cliente?")){
    clientes.splice(idx,1);
    localStorage.setItem("clientes", JSON.stringify(clientes));
    exibirClientes();
  }
}

/* filter */
filtroNome.addEventListener("input", exibirClientes);

/* init */
window.addEventListener("DOMContentLoaded", ()=>{
  const tema = localStorage.getItem("tema");
  if(tema === "light") document.body.classList.add("light");
  exibirClientes();
});
</script>
</body>
</html>
